define ("realtimeplugin_phppoll/realtime",["core/pubsub","tool_realtime/events"],function(a,b){var c,d=[],e,f=new XMLHttpRequest,g,h=function(){var c=new Date,e=c.getTime();d.push(e);d=d.slice(-10);if(10<=d.length&&5e3>e-d[0]){a.publish(b.CONNECTION_LOST);return!1}return!0},j=function(){if(!h()){return}f.onreadystatechange=function(){if(4===this.readyState&&200===this.status){if(200===this.status){try{g=JSON.parse(this.responseText)}catch(a){setTimeout(j,c.timeout);return}if(!g.success||1!==g.success){return}var d=g.events;for(var e in d){a.publish(b.EVENT,d[e]);c.fromid=d[e].id}setTimeout(j,c.timeout)}else{setTimeout(j,c.timeout)}}};var d=e+"?userid="+encodeURIComponent(c.userid)+"&token="+encodeURIComponent(c.token)+"&fromid="+encodeURIComponent(c.fromid)+"&channel="+encodeURIComponent(c.context)+":"+encodeURIComponent(c.component)+":"+encodeURIComponent(c.area)+":"+encodeURIComponent(c.itemid);f.open("GET",d,!0);f.send()};return{init:function init(a,b,d,g,h,i,k,l,m){if(c&&c.userid){f.abort();c.context+="-"+d;c.component+="-"+g;c.area+="-"+h;c.itemid+="-"+i}else{c={userid:a,token:b,context:d,component:g,area:h,itemid:i,fromid:k,timeout:m}}e=l;setTimeout(j,m)}}});
//# sourceMappingURL=realtime.min.js.map
