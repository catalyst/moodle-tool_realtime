define ("realtimeplugin_phppoll/realtime",["core/pubsub","tool_realtime/events","tool_realtime/api"],function(a,b,c){var d,e=[],f,g=new XMLHttpRequest,h,i=function(){var c=new Date,d=c.getTime();e.push(d);e=e.slice(-10);if(10<=e.length&&5e3>d-e[0]){a.publish(b.CONNECTION_LOST);return!1}return!0},j=function(){if(!i()){return}g.onreadystatechange=function(){if(4===this.readyState&&200===this.status){if(200===this.status){try{h=JSON.parse(this.responseText)}catch(a){setTimeout(j,d.timeout);return}if(!h.success||1!==h.success){return}var c=h.events;for(var e in c){a.publish(b.EVENT,c[e]);d.fromid=c[e].id}setTimeout(j,d.timeout)}else{setTimeout(j,d.timeout)}}};var c=f+"?userid="+encodeURIComponent(d.userid)+"&token="+encodeURIComponent(d.token)+"&fromid="+encodeURIComponent(d.fromid)+"&channel="+encodeURIComponent(d.context)+":"+encodeURIComponent(d.component)+":"+encodeURIComponent(d.area)+":"+encodeURIComponent(d.itemid)+":"+encodeURIComponent(d.fromtimestamp);g.open("GET",c,!0);g.send()},k={init:function init(a,b,e,g){if(!(d&&d.userid)){d={userid:a,token:b,timeout:g}}f=e;c.setImplementation(k)},subscribe:function subscribe(a,b,c,e,f,h){if(d&&d.userid&&d.context){g.abort();d.fromid=f;d.context+="-"+a;d.component+="-"+b;d.area+="-"+c;d.itemid+="-"+e;d.fromtimestamp+="-"+h}else{d.context=a;d.component=b;d.area=c;d.itemid=e;d.fromid=f;d.fromtimestamp=h}setTimeout(j,d.timeout)}};return k});
//# sourceMappingURL=realtime.min.js.map
