{"version":3,"sources":["../src/realtime.js"],"names":["require","config","enforceDefine","paths","define","PubSub","RealTimeEvents","Pusher","params","subToChannel","pusher","key","cluster","channelString","context","component","area","itemid","channel","subscribe","bind","data","channelObj","split","payload","JSON","parse","dataToSend","publish","EVENT","init","userId","app_id","secret","userid"],"mappings":"AAQAA,OAAO,CAACC,MAAR,CAAe,CACXC,aAAa,GADF,CAEXC,KAAK,CAAE,CACH,aAAc,kCADX,CAFI,CAAf,EAOAC,OAAM,kCAAC,CAAC,aAAD,CAAgB,sBAAhB,CAAwC,YAAxC,CAAD,CAAwD,SAASC,CAAT,CAAiBC,CAAjB,CAAiCC,CAAjC,CAAyC,IAE/FC,CAAAA,CAF+F,CAK/FC,CAAY,CAAG,UAAW,IACtBC,CAAAA,CAAM,CAAG,GAAIH,CAAAA,CAAJ,CAAWC,CAAM,CAACG,GAAlB,CAAuB,CAChCC,OAAO,CAAEJ,CAAM,CAACI,OADgB,CAAvB,CADa,CAKtBC,CAAa,CAAGL,CAAM,CAACM,OAAP,CAAiB,GAAjB,CAAuBN,CAAM,CAACO,SAA9B,CAA0C,GAA1C,CAAgDP,CAAM,CAACQ,IAAvD,CAA8D,GAA9D,CAAoER,CAAM,CAACS,MALrE,CAOtBC,CAAO,CAAGR,CAAM,CAACS,SAAP,CAAiBN,CAAjB,CAPY,CAQ1BK,CAAO,CAACE,IAAR,CAAa,OAAb,CAAsB,SAASC,CAAT,CAAe,IAC7BC,CAAAA,CAAU,CAAGT,CAAa,CAACU,KAAd,CAAoB,GAApB,CADgB,CAE7BC,CAAO,CAAGC,IAAI,CAACC,KAAL,CAAWL,CAAX,CAFmB,CAG7BM,CAAU,CAAG,CAAC,OAAWL,CAAU,CAAC,CAAD,CAAtB,CAA2B,UAAcA,CAAU,CAAC,CAAD,CAAnD,CAAwD,KAASA,CAAU,CAAC,CAAD,CAA3E,CAAgF,QAAYE,CAA5F,CAHgB,CAV5BnB,CAcL,CAAOuB,OAAP,CAbatB,CAaE,CAAeuB,KAA9B,CAAqCF,CAArC,CACH,CALD,CAMH,CAnBkG,CAqBnG,MAAO,CACHG,IAAI,CAAE,cAASC,CAAT,CAAiBjB,CAAjB,CAA0BC,CAA1B,CAAqCC,CAArC,CAA2CC,CAA3C,CAAmDe,CAAnD,CAA2DrB,CAA3D,CAAgEsB,CAAhE,CAAwErB,CAAxE,CAAiF,CACnFJ,CAAM,CAAG,CACL0B,MAAM,CAAEH,CADH,CAELjB,OAAO,CAAEA,CAFJ,CAGLC,SAAS,CAAEA,CAHN,CAILC,IAAI,CAAEA,CAJD,CAKLC,MAAM,CAAEA,CALH,CAMLe,MAAM,CAAEA,CANH,CAOLrB,GAAG,CAAEA,CAPA,CAQLsB,MAAM,CAAEA,CARH,CASLrB,OAAO,CAAEA,CATJ,CAAT,CAWAH,CAAY,EACf,CAdE,CAiBV,CAtCK,CAAN","sourcesContent":["/**\n * Real time events\n *\n * @module     realtimeplugin_phppoll/realtime\n * @package    realtimeplugin_phppoll\n * @copyright  2020 Marina Glancy\n */\n\nrequire.config({\n    enforceDefine: false,\n    paths: {\n        \"pusher-7.0\": 'https://js.pusher.com/7.0/pusher'\n    }\n});\n\ndefine(['core/pubsub', 'tool_realtime/events', 'pusher-7.0'], function(PubSub, RealTimeEvents, Pusher) {\n\n    var params;\n    var pubSub = PubSub;\n    var realTimeEvents = RealTimeEvents;\n    var subToChannel = function() {\n        var pusher = new Pusher(params.key, {\n            cluster: params.cluster\n        });\n\n        var channelString = params.context + '-' + params.component + '-' + params.area + '-' + params.itemid;\n\n        var channel = pusher.subscribe(channelString);\n        channel.bind('event', function(data) {\n            var channelObj = channelString.split('-');\n            var payload = JSON.parse(data);\n            var dataToSend = {\"itemid\" : channelObj[3], \"component\" : channelObj[1], \"area\" : channelObj[2], \"payload\" : payload};\n            pubSub.publish(realTimeEvents.EVENT, dataToSend);\n        });\n    };\n\n    return {\n        init: function(userId, context, component, area, itemid, app_id, key, secret, cluster) {\n            params = {\n                userid: userId,\n                context: context,\n                component: component,\n                area: area,\n                itemid: itemid,\n                app_id: app_id,\n                key: key,\n                secret: secret,\n                cluster: cluster\n            };\n            subToChannel();\n        }\n\n    };\n});\n"],"file":"realtime.min.js"}